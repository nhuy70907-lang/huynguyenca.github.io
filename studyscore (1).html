<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StudyScore - Theo d√µi ƒëi·ªÉm h·ªçc t·∫≠p</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .nav-tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
        }

        .nav-tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
            background: none;
            font-size: 16px;
            font-weight: 500;
        }

        .nav-tab:hover {
            background: #e9ecef;
        }

        .nav-tab.active {
            background: white;
            border-bottom: 3px solid #667eea;
            color: #667eea;
        }

        .content {
            padding: 30px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .semester-selector {
            margin-bottom: 30px;
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .semester-btn {
            padding: 10px 30px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
        }

        .semester-btn:hover {
            background: #667eea;
            color: white;
        }

        .semester-btn.active {
            background: #667eea;
            color: white;
        }

        .subject-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .subject-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }

        .subject-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }

        .subject-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .subject-name {
            font-size: 1.3em;
            font-weight: bold;
            color: #333;
        }

        .subject-avg {
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
        }

        .score-inputs {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .score-group {
            display: flex;
            flex-direction: column;
        }

        .score-group label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }

        .score-group input {
            padding: 8px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .score-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .score-group input::placeholder {
            color: #adb5bd;
            font-size: 13px;
        }

        .summary-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .summary-item {
            background: rgba(255,255,255,0.2);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .summary-label {
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .summary-value {
            font-size: 2em;
            font-weight: bold;
        }

        .ranking-badge {
            display: inline-block;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: bold;
            margin-top: 10px;
        }

        .ranking-xuatsac { background: #ffd700; color: #333; }
        .ranking-gioi { background: #ff6b6b; color: white; }
        .ranking-kha { background: #4ecdc4; color: white; }
        .ranking-trungbinh { background: #95e1d3; color: #333; }
        .ranking-yeu { background: #95a5a6; color: white; }

        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .chart-title {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 20px;
            color: #333;
        }

        .bar-chart {
            display: flex;
            align-items: flex-end;
            height: 300px;
            gap: 10px;
            padding: 20px 0;
        }

        .bar-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .bar {
            width: 100%;
            background: linear-gradient(to top, #667eea, #764ba2);
            border-radius: 10px 10px 0 0;
            position: relative;
            transition: all 0.3s;
            min-height: 20px;
        }

        .bar:hover {
            opacity: 0.8;
        }

        .bar-value {
            position: absolute;
            top: -25px;
            width: 100%;
            text-align: center;
            font-weight: bold;
            color: #667eea;
        }

        .bar-label {
            font-size: 0.9em;
            text-align: center;
            color: #666;
            word-wrap: break-word;
        }

        .goal-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .goal-input-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .goal-input {
            flex: 1;
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 16px;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
        }

        .btn-success {
            background: #51cf66;
            color: white;
        }

        .btn-success:hover {
            background: #40c057;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .progress-comparison {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .comparison-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .comparison-header {
            font-weight: bold;
            margin-bottom: 10px;
            color: #667eea;
        }

        .comparison-value {
            font-size: 2em;
            font-weight: bold;
            color: #333;
        }

        .comparison-change {
            margin-top: 10px;
            padding: 5px 10px;
            border-radius: 5px;
            display: inline-block;
        }

        .change-up {
            background: #d4edda;
            color: #155724;
        }

        .change-down {
            background: #f8d7da;
            color: #721c24;
        }

        .change-same {
            background: #d1ecf1;
            color: #0c5460;
        }

        @media (max-width: 768px) {
            .subject-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 1.8em;
            }

            .nav-tab {
                font-size: 14px;
                padding: 12px 5px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéì StudyScore</h1>
            <p>Theo d√µi ƒëi·ªÉm h·ªçc t·∫≠p th√¥ng minh - Gi√∫p b·∫°n ti·∫øn b·ªô m·ªói ng√†y</p>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('grades')">üìù Nh·∫≠p ƒëi·ªÉm</button>
            <button class="nav-tab" onclick="switchTab('summary')">üìä T·ªïng k·∫øt</button>
            <button class="nav-tab" onclick="switchTab('progress')">üìà Ti·∫øn b·ªô</button>
            <button class="nav-tab" onclick="switchTab('goals')">üéØ M·ª•c ti√™u</button>
            <button class="nav-tab" onclick="switchTab('settings')">‚öôÔ∏è C√†i ƒë·∫∑t</button>
        </div>

        <div class="content">
            <!-- Tab Nh·∫≠p ƒëi·ªÉm -->
            <div id="grades-tab" class="tab-content active">
                <div class="semester-selector">
                    <button class="semester-btn active" onclick="selectSemester(1)">H·ªçc k·ª≥ 1</button>
                    <button class="semester-btn" onclick="selectSemester(2)">H·ªçc k·ª≥ 2</button>
                </div>

                <div id="subjects-container" class="subject-grid"></div>

                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn btn-success" onclick="saveAllData()">üíæ L∆∞u t·∫•t c·∫£ ƒëi·ªÉm</button>
                </div>
            </div>

            <!-- Tab T·ªïng k·∫øt -->
            <div id="summary-tab" class="tab-content">
                <div class="summary-section">
                    <h2 style="text-align: center; margin-bottom: 10px;">K·∫øt qu·∫£ h·ªçc t·∫≠p</h2>
                    <div class="summary-grid">
                        <div class="summary-item">
                            <div class="summary-label">H·ªçc k·ª≥ 1</div>
                            <div class="summary-value" id="avg-sem1">0.0</div>
                            <div id="rank-sem1" class="ranking-badge">Ch∆∞a c√≥ d·ªØ li·ªáu</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-label">H·ªçc k·ª≥ 2</div>
                            <div class="summary-value" id="avg-sem2">0.0</div>
                            <div id="rank-sem2" class="ranking-badge">Ch∆∞a c√≥ d·ªØ li·ªáu</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-label">C·∫£ nƒÉm</div>
                            <div class="summary-value" id="avg-year">0.0</div>
                            <div id="rank-year" class="ranking-badge">Ch∆∞a c√≥ d·ªØ li·ªáu</div>
                        </div>
                    </div>
                </div>

                <div class="chart-container">
                    <div class="chart-title">üìä ƒêi·ªÉm trung b√¨nh c√°c m√¥n (H·ªçc k·ª≥ hi·ªán t·∫°i)</div>
                    <div class="bar-chart" id="subject-chart"></div>
                </div>
            </div>

            <!-- Tab Ti·∫øn b·ªô -->
            <div id="progress-tab" class="tab-content">
                <div class="chart-container">
                    <div class="chart-title">üìà So s√°nh ti·∫øn b·ªô gi·ªØa c√°c h·ªçc k·ª≥</div>
                    <div class="progress-comparison" id="progress-comparison"></div>
                </div>

                <div class="chart-container">
                    <div class="chart-title">Ph√¢n t√≠ch chi ti·∫øt</div>
                    <div id="progress-details"></div>
                </div>
            </div>

            <!-- Tab M·ª•c ti√™u -->
            <div id="goals-tab" class="tab-content">
                <div class="goal-section">
                    <h3>üéØ ƒê·∫∑t m·ª•c ti√™u h·ªçc t·∫≠p</h3>
                    <div class="goal-input-group">
                        <input type="number" class="goal-input" id="goal-input" placeholder="Nh·∫≠p ƒëi·ªÉm m·ª•c ti√™u (VD: 8.0)" step="0.1" min="0" max="10">
                        <button class="btn btn-primary" onclick="setGoal()">ƒê·∫∑t m·ª•c ti√™u</button>
                    </div>
                    <div id="goal-status"></div>
                </div>

                <div class="chart-container">
                    <div class="chart-title">‚ö†Ô∏è C·∫£nh b√°o v√† ƒë·ªÅ xu·∫•t</div>
                    <div id="warnings-container"></div>
                </div>
            </div>

            <!-- Tab C√†i ƒë·∫∑t -->
            <div id="settings-tab" class="tab-content">
                <div class="chart-container">
                    <div class="chart-title">üìö Ch·ªçn m√¥n h·ªçc b·∫°n ƒëang theo h·ªçc</div>
                    <p style="color: #666; margin-bottom: 20px;">Ch·ªçn c√°c m√¥n h·ªçc b·∫°n ƒëang h·ªçc trong ch∆∞∆°ng tr√¨nh. ƒêi·ªÅu n√†y gi√∫p ·ª©ng d·ª•ng t√≠nh ƒëi·ªÉm trung b√¨nh ch√≠nh x√°c h∆°n.</p>
                    
                    <div style="margin-bottom: 20px;">
                        <button class="btn btn-primary" onclick="selectAllSubjects()" style="margin-right: 10px;">‚úÖ Ch·ªçn t·∫•t c·∫£</button>
                        <button class="btn btn-primary" onclick="deselectAllSubjects()">‚ùå B·ªè ch·ªçn t·∫•t c·∫£</button>
                    </div>

                    <div id="subject-selector" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;"></div>

                    <div style="margin-top: 20px; text-align: center;">
                        <button class="btn btn-success" onclick="saveSubjectSettings()">üíæ L∆∞u c√†i ƒë·∫∑t</button>
                    </div>
                </div>

                <div class="chart-container" style="margin-top: 20px;">
                    <div class="chart-title">üóëÔ∏è X√≥a d·ªØ li·ªáu</div>
                    <p style="color: #666; margin-bottom: 15px;">X√≥a to√†n b·ªô d·ªØ li·ªáu ƒëi·ªÉm v√† b·∫Øt ƒë·∫ßu l·∫°i t·ª´ ƒë·∫ßu.</p>
                    <button class="btn" style="background: #ff6b6b; color: white;" onclick="resetAllData()">üóëÔ∏è X√≥a t·∫•t c·∫£ d·ªØ li·ªáu</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Danh s√°ch t·∫•t c·∫£ m√¥n h·ªçc THPT
        const ALL_SUBJECTS = [
            'To√°n', 'Ng·ªØ vƒÉn', 'Ti·∫øng Anh', 'V·∫≠t l√Ω', 'H√≥a h·ªçc', 
            'Sinh h·ªçc', 'L·ªãch s·ª≠', 'ƒê·ªãa l√Ω', 'GDCD', 'Gi√°o d·ª•c Qu·ªëc ph√≤ng'
        ];

        // Danh s√°ch m√¥n h·ªçc ƒë√£ ch·ªçn (m·∫∑c ƒë·ªãnh l√† t·∫•t c·∫£)
        let SUBJECTS = [...ALL_SUBJECTS];

        // D·ªØ li·ªáu ·ª©ng d·ª•ng
        let currentSemester = 1;
        let appData = {
            semester1: {},
            semester2: {},
            goal: null,
            selectedSubjects: [...ALL_SUBJECTS] // M·∫∑c ƒë·ªãnh ch·ªçn t·∫•t c·∫£ m√¥n
        };

        // Kh·ªüi t·∫°o d·ªØ li·ªáu cho c√°c m√¥n h·ªçc
        function initializeData() {
            ALL_SUBJECTS.forEach(subject => {
                if (!appData.semester1[subject]) {
                    appData.semester1[subject] = {
                        mieng: [],
                        p15: [],
                        p1tiet: [],
                        giuaky: [],
                        cuoiky: []
                    };
                }
                if (!appData.semester2[subject]) {
                    appData.semester2[subject] = {
                        mieng: [],
                        p15: [],
                        p1tiet: [],
                        giuaky: [],
                        cuoiky: []
                    };
                }
            });
        }

        // T·∫£i d·ªØ li·ªáu t·ª´ localStorage
        function loadData() {
            const saved = localStorage.getItem('studyscoreData');
            if (saved) {
                appData = JSON.parse(saved);
                // ƒê·∫£m b·∫£o c√≥ selectedSubjects
                if (!appData.selectedSubjects) {
                    appData.selectedSubjects = [...ALL_SUBJECTS];
                }
                // C·∫≠p nh·∫≠t danh s√°ch m√¥n h·ªçc hi·ªán t·∫°i
                SUBJECTS = [...appData.selectedSubjects];
            } else {
                initializeData();
            }
        }

        // L∆∞u d·ªØ li·ªáu v√†o localStorage
        function saveData() {
            localStorage.setItem('studyscoreData', JSON.stringify(appData));
        }

        // T√≠nh ƒëi·ªÉm trung b√¨nh m√¥n
        function calculateSubjectAverage(scores) {
            let totalScore = 0;
            let totalWeight = 0;

            // ƒêi·ªÉm mi·ªáng v√† 15 ph√∫t: h·ªá s·ªë 1
            scores.mieng.forEach(score => {
                if (score !== '' && score !== null) {
                    totalScore += parseFloat(score) * 1;
                    totalWeight += 1;
                }
            });
            scores.p15.forEach(score => {
                if (score !== '' && score !== null) {
                    totalScore += parseFloat(score) * 1;
                    totalWeight += 1;
                }
            });

            // ƒêi·ªÉm 1 ti·∫øt v√† gi·ªØa k·ª≥: h·ªá s·ªë 2
            scores.p1tiet.forEach(score => {
                if (score !== '' && score !== null) {
                    totalScore += parseFloat(score) * 2;
                    totalWeight += 2;
                }
            });
            scores.giuaky.forEach(score => {
                if (score !== '' && score !== null) {
                    totalScore += parseFloat(score) * 2;
                    totalWeight += 2;
                }
            });

            // ƒêi·ªÉm cu·ªëi k·ª≥: h·ªá s·ªë 3
            scores.cuoiky.forEach(score => {
                if (score !== '' && score !== null) {
                    totalScore += parseFloat(score) * 3;
                    totalWeight += 3;
                }
            });

            return totalWeight > 0 ? (totalScore / totalWeight).toFixed(2) : 0;
        }

        // T√≠nh ƒëi·ªÉm trung b√¨nh h·ªçc k·ª≥
        function calculateSemesterAverage(semester) {
            let total = 0;
            let count = 0;

            SUBJECTS.forEach(subject => {
                const avg = parseFloat(calculateSubjectAverage(appData[semester][subject]));
                if (avg > 0) {
                    total += avg;
                    count++;
                }
            });

            return count > 0 ? (total / count).toFixed(2) : 0;
        }

        // X·∫øp lo·∫°i h·ªçc l·ª±c
        function getRanking(average) {
            const avg = parseFloat(average);
            if (avg >= 9.0) return { text: 'Xu·∫•t s·∫Øc', class: 'ranking-xuatsac' };
            if (avg >= 8.0) return { text: 'Gi·ªèi', class: 'ranking-gioi' };
            if (avg >= 6.5) return { text: 'Kh√°', class: 'ranking-kha' };
            if (avg >= 5.0) return { text: 'Trung b√¨nh', class: 'ranking-trungbinh' };
            if (avg > 0) return { text: 'Y·∫øu', class: 'ranking-yeu' };
            return { text: 'Ch∆∞a c√≥ d·ªØ li·ªáu', class: '' };
        }

        // Render giao di·ªán nh·∫≠p ƒëi·ªÉm
        function renderSubjects() {
            const container = document.getElementById('subjects-container');
            const semester = `semester${currentSemester}`;
            
            container.innerHTML = SUBJECTS.map(subject => {
                const scores = appData[semester][subject];
                const average = calculateSubjectAverage(scores);
                
                return `
                    <div class="subject-card">
                        <div class="subject-header">
                            <span class="subject-name">${subject}</span>
                            <span class="subject-avg">${average}</span>
                        </div>
                        <div class="score-inputs">
                            <div class="score-group" style="grid-column: span 2;">
                                <label>ƒêi·ªÉm mi·ªáng (t·ªëi ƒëa 3 c·ªôt)</label>
                                <div style="display: flex; gap: 5px;">
                                    <input type="number" step="0.1" min="0" max="10" 
                                        placeholder="1"
                                        value="${scores.mieng[0] || ''}"
                                        onchange="updateScore('${subject}', 'mieng', 0, this.value)"
                                        style="flex: 1; min-width: 60px; padding: 10px; border: 2px solid #dee2e6; border-radius: 8px; font-size: 15px; text-align: center;">
                                    <input type="number" step="0.1" min="0" max="10" 
                                        placeholder="2"
                                        value="${scores.mieng[1] || ''}"
                                        onchange="updateScore('${subject}', 'mieng', 1, this.value)"
                                        style="flex: 1; min-width: 60px; padding: 10px; border: 2px solid #dee2e6; border-radius: 8px; font-size: 15px; text-align: center;">
                                    <input type="number" step="0.1" min="0" max="10" 
                                        placeholder="3"
                                        value="${scores.mieng[2] || ''}"
                                        onchange="updateScore('${subject}', 'mieng', 2, this.value)"
                                        style="flex: 1; min-width: 60px; padding: 10px; border: 2px solid #dee2e6; border-radius: 8px; font-size: 15px; text-align: center;">
                                </div>
                            </div>
                            <div class="score-group">
                                <label>ƒêi·ªÉm 15 ph√∫t</label>
                                <input type="number" step="0.1" min="0" max="10" 
                                    value="${scores.p15[0] || ''}"
                                    onchange="updateScore('${subject}', 'p15', 0, this.value)">
                            </div>
                            <div class="score-group">
                                <label>ƒêi·ªÉm 1 ti·∫øt</label>
                                <input type="number" step="0.1" min="0" max="10" 
                                    value="${scores.p1tiet[0] || ''}"
                                    onchange="updateScore('${subject}', 'p1tiet', 0, this.value)">
                            </div>
                            <div class="score-group">
                                <label>ƒêi·ªÉm gi·ªØa k·ª≥</label>
                                <input type="number" step="0.1" min="0" max="10" 
                                    value="${scores.giuaky[0] || ''}"
                                    onchange="updateScore('${subject}', 'giuaky', 0, this.value)">
                            </div>
                            <div class="score-group">
                                <label>ƒêi·ªÉm cu·ªëi k·ª≥</label>
                                <input type="number" step="0.1" min="0" max="10" 
                                    value="${scores.cuoiky[0] || ''}"
                                    onchange="updateScore('${subject}', 'cuoiky', 0, this.value)">
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Render nh√≥m input ƒëi·ªÉm v·ªõi s·ªë l∆∞·ª£ng √¥ t√πy ch·ªânh
        function renderScoreInputGroup(subject, type, label, scores, maxInputs) {
            let inputs = '';
            for (let i = 0; i < maxInputs; i++) {
                inputs += `
                    <input type="number" step="0.1" min="0" max="10" 
                        placeholder="${i + 1}"
                        value="${scores[i] || ''}"
                        onchange="updateScore('${subject}', '${type}', ${i}, this.value)"
                        style="flex: 1; min-width: 60px;">
                `;
            }
            
            return `
                <div class="score-group" style="grid-column: span 2;">
                    <label>${label} ${maxInputs > 1 ? `(t·ªëi ƒëa ${maxInputs} c·ªôt)` : ''}</label>
                    <div style="display: flex; gap: 5px;">
                        ${inputs}
                    </div>
                </div>
            `;
        }

        // C·∫≠p nh·∫≠t ƒëi·ªÉm
        function updateScore(subject, type, index, value) {
            const semester = `semester${currentSemester}`;
            appData[semester][subject][type][index] = value === '' ? null : parseFloat(value);
            renderSubjects();
            updateSummary();
        }

        // L∆∞u t·∫•t c·∫£ d·ªØ li·ªáu
        function saveAllData() {
            saveData();
            alert('‚úÖ ƒê√£ l∆∞u t·∫•t c·∫£ ƒëi·ªÉm th√†nh c√¥ng!');
        }

        // Chuy·ªÉn h·ªçc k·ª≥
        function selectSemester(semester) {
            currentSemester = semester;
            
            // C·∫≠p nh·∫≠t n√∫t active
            document.querySelectorAll('.semester-btn').forEach((btn, index) => {
                btn.classList.toggle('active', index + 1 === semester);
            });
            
            renderSubjects();
            updateSummary();
        }

        // Chuy·ªÉn tab
        function switchTab(tabName) {
            // ·∫®n t·∫•t c·∫£ tab
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.nav-tab').forEach(btn => {
                btn.classList.remove('active');
            });

            // Hi·ªán tab ƒë∆∞·ª£c ch·ªçn
            document.getElementById(`${tabName}-tab`).classList.add('active');
            event.target.classList.add('active');

            // C·∫≠p nh·∫≠t n·ªôi dung
            if (tabName === 'summary') updateSummary();
            if (tabName === 'progress') updateProgress();
            if (tabName === 'goals') updateGoals();
            if (tabName === 'settings') renderSubjectSelector();
        }

        // Render giao di·ªán ch·ªçn m√¥n h·ªçc
        function renderSubjectSelector() {
            const container = document.getElementById('subject-selector');
            
            container.innerHTML = ALL_SUBJECTS.map(subject => {
                const isChecked = appData.selectedSubjects.includes(subject);
                return `
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; display: flex; align-items: center; gap: 10px;">
                        <input type="checkbox" id="subject-${subject}" 
                            ${isChecked ? 'checked' : ''} 
                            onchange="toggleSubject('${subject}')"
                            style="width: 20px; height: 20px; cursor: pointer;">
                        <label for="subject-${subject}" style="cursor: pointer; font-size: 16px; flex: 1;">${subject}</label>
                    </div>
                `;
            }).join('');
        }

        // Toggle ch·ªçn m√¥n h·ªçc
        function toggleSubject(subject) {
            const index = appData.selectedSubjects.indexOf(subject);
            if (index > -1) {
                appData.selectedSubjects.splice(index, 1);
            } else {
                appData.selectedSubjects.push(subject);
            }
        }

        // Ch·ªçn t·∫•t c·∫£ m√¥n h·ªçc
        function selectAllSubjects() {
            appData.selectedSubjects = [...ALL_SUBJECTS];
            renderSubjectSelector();
        }

        // B·ªè ch·ªçn t·∫•t c·∫£ m√¥n h·ªçc
        function deselectAllSubjects() {
            appData.selectedSubjects = [];
            renderSubjectSelector();
        }

        // L∆∞u c√†i ƒë·∫∑t m√¥n h·ªçc
        function saveSubjectSettings() {
            if (appData.selectedSubjects.length === 0) {
                alert('‚ö†Ô∏è B·∫°n ph·∫£i ch·ªçn √≠t nh·∫•t 1 m√¥n h·ªçc!');
                return;
            }

            SUBJECTS = [...appData.selectedSubjects];
            saveData();
            renderSubjects();
            updateSummary();
            alert(`‚úÖ ƒê√£ l∆∞u c√†i ƒë·∫∑t! B·∫°n ƒëang theo h·ªçc ${SUBJECTS.length} m√¥n.`);
        }

        // X√≥a t·∫•t c·∫£ d·ªØ li·ªáu
        function resetAllData() {
            if (confirm('‚ö†Ô∏è B·∫†N C√ì CH·∫ÆC MU·ªêN X√ìA T·∫§T C·∫¢ D·ªÆ LI·ªÜU?\n\nH√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c!')) {
                localStorage.removeItem('studyscoreData');
                appData = {
                    semester1: {},
                    semester2: {},
                    goal: null,
                    selectedSubjects: [...ALL_SUBJECTS]
                };
                SUBJECTS = [...ALL_SUBJECTS];
                initializeData();
                renderSubjects();
                updateSummary();
                alert('‚úÖ ƒê√£ x√≥a t·∫•t c·∫£ d·ªØ li·ªáu!');
            }
        }

        // C·∫≠p nh·∫≠t t·ªïng k·∫øt
        function updateSummary() {
            // T√≠nh ƒëi·ªÉm trung b√¨nh
            const avgSem1 = calculateSemesterAverage('semester1');
            const avgSem2 = calculateSemesterAverage('semester2');
            const avgYear = ((parseFloat(avgSem1) + parseFloat(avgSem2)) / 2).toFixed(2);

            // Hi·ªÉn th·ªã ƒëi·ªÉm
            document.getElementById('avg-sem1').textContent = avgSem1;
            document.getElementById('avg-sem2').textContent = avgSem2;
            document.getElementById('avg-year').textContent = avgYear;

            // Hi·ªÉn th·ªã x·∫øp lo·∫°i
            const rank1 = getRanking(avgSem1);
            const rank2 = getRanking(avgSem2);
            const rankYear = getRanking(avgYear);

            document.getElementById('rank-sem1').textContent = rank1.text;
            document.getElementById('rank-sem1').className = `ranking-badge ${rank1.class}`;

            document.getElementById('rank-sem2').textContent = rank2.text;
            document.getElementById('rank-sem2').className = `ranking-badge ${rank2.class}`;

            document.getElementById('rank-year').textContent = rankYear.text;
            document.getElementById('rank-year').className = `ranking-badge ${rankYear.class}`;

            // C·∫≠p nh·∫≠t bi·ªÉu ƒë·ªì
            updateSubjectChart();
        }

        // C·∫≠p nh·∫≠t bi·ªÉu ƒë·ªì m√¥n h·ªçc
        function updateSubjectChart() {
            const container = document.getElementById('subject-chart');
            const semester = `semester${currentSemester}`;
            
            const chartData = SUBJECTS.map(subject => {
                const avg = calculateSubjectAverage(appData[semester][subject]);
                return { subject, avg: parseFloat(avg) };
            }).filter(item => item.avg > 0);

            if (chartData.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #999;">Ch∆∞a c√≥ d·ªØ li·ªáu ƒëi·ªÉm</p>';
                return;
            }

            container.innerHTML = chartData.map(item => `
                <div class="bar-item">
                    <div class="bar" style="height: ${item.avg * 30}px">
                        <div class="bar-value">${item.avg}</div>
                    </div>
                    <div class="bar-label">${item.subject}</div>
                </div>
            `).join('');
        }

        // C·∫≠p nh·∫≠t ti·∫øn b·ªô
        function updateProgress() {
            const comparisonContainer = document.getElementById('progress-comparison');
            const detailsContainer = document.getElementById('progress-details');

            const avgSem1 = parseFloat(calculateSemesterAverage('semester1'));
            const avgSem2 = parseFloat(calculateSemesterAverage('semester2'));

            // So s√°nh t·ªïng qu√°t
            let changeClass = 'change-same';
            let changeText = 'Kh√¥ng ƒë·ªïi';
            let changeValue = 0;

            if (avgSem2 > avgSem1 && avgSem1 > 0) {
                changeClass = 'change-up';
                changeValue = (avgSem2 - avgSem1).toFixed(2);
                changeText = `TƒÉng ${changeValue} ƒëi·ªÉm ‚¨ÜÔ∏è`;
            } else if (avgSem2 < avgSem1 && avgSem2 > 0) {
                changeClass = 'change-down';
                changeValue = (avgSem1 - avgSem2).toFixed(2);
                changeText = `Gi·∫£m ${changeValue} ƒëi·ªÉm ‚¨áÔ∏è`;
            }

            comparisonContainer.innerHTML = `
                <div class="comparison-card">
                    <div class="comparison-header">H·ªçc k·ª≥ 1</div>
                    <div class="comparison-value">${avgSem1 || '0.0'}</div>
                </div>
                <div class="comparison-card">
                    <div class="comparison-header">H·ªçc k·ª≥ 2</div>
                    <div class="comparison-value">${avgSem2 || '0.0'}</div>
                    ${avgSem1 > 0 && avgSem2 > 0 ? `<div class="comparison-change ${changeClass}">${changeText}</div>` : ''}
                </div>
            `;

            // Chi ti·∫øt t·ª´ng m√¥n
            let details = '<h4 style="margin-bottom: 15px;">üìö Chi ti·∫øt t·ª´ng m√¥n:</h4>';
            
            SUBJECTS.forEach(subject => {
                const avg1 = parseFloat(calculateSubjectAverage(appData.semester1[subject]));
                const avg2 = parseFloat(calculateSubjectAverage(appData.semester2[subject]));

                if (avg1 > 0 || avg2 > 0) {
                    let subjectChange = '';
                    if (avg1 > 0 && avg2 > 0) {
                        const diff = (avg2 - avg1).toFixed(2);
                        if (avg2 > avg1) {
                            subjectChange = `<span style="color: #51cf66;">‚¨ÜÔ∏è +${diff}</span>`;
                        } else if (avg2 < avg1) {
                            subjectChange = `<span style="color: #ff6b6b;">‚¨áÔ∏è ${diff}</span>`;
                        } else {
                            subjectChange = `<span style="color: #999;">‚û°Ô∏è 0.00</span>`;
                        }
                    }

                    details += `
                        <div style="padding: 10px; background: #f8f9fa; margin-bottom: 10px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center;">
                            <strong>${subject}:</strong>
                            <span>HK1: ${avg1 || '-'} | HK2: ${avg2 || '-'} ${subjectChange}</span>
                        </div>
                    `;
                }
            });

            detailsContainer.innerHTML = details;
        }

        // ƒê·∫∑t m·ª•c ti√™u
        function setGoal() {
            const goalInput = document.getElementById('goal-input');
            const goal = parseFloat(goalInput.value);

            if (isNaN(goal) || goal < 0 || goal > 10) {
                alert('‚ö†Ô∏è Vui l√≤ng nh·∫≠p ƒëi·ªÉm m·ª•c ti√™u h·ª£p l·ªá (0-10)');
                return;
            }

            appData.goal = goal;
            saveData();
            updateGoals();
            alert(`üéØ ƒê√£ ƒë·∫∑t m·ª•c ti√™u: ${goal} ƒëi·ªÉm`);
        }

        // C·∫≠p nh·∫≠t m·ª•c ti√™u v√† c·∫£nh b√°o
        function updateGoals() {
            const statusContainer = document.getElementById('goal-status');
            const warningsContainer = document.getElementById('warnings-container');

            // Hi·ªÉn th·ªã tr·∫°ng th√°i m·ª•c ti√™u
            if (appData.goal) {
                const currentAvg = parseFloat(calculateSemesterAverage(`semester${currentSemester}`));
                const diff = (appData.goal - currentAvg).toFixed(2);

                let statusClass = 'alert-info';
                let statusText = '';

                if (currentAvg >= appData.goal) {
                    statusClass = 'alert-success';
                    statusText = `üéâ Xu·∫•t s·∫Øc! B·∫°n ƒë√£ ƒë·∫°t m·ª•c ti√™u ${appData.goal} ƒëi·ªÉm. ƒêi·ªÉm hi·ªán t·∫°i: ${currentAvg}`;
                } else {
                    statusClass = 'alert-warning';
                    statusText = `üí™ C·ªë l√™n! B·∫°n c·∫ßn c·∫£i thi·ªán th√™m ${diff} ƒëi·ªÉm ƒë·ªÉ ƒë·∫°t m·ª•c ti√™u ${appData.goal}`;
                }

                statusContainer.innerHTML = `<div class="alert ${statusClass}">${statusText}</div>`;
            } else {
                statusContainer.innerHTML = '<div class="alert alert-info">B·∫°n ch∆∞a ƒë·∫∑t m·ª•c ti√™u n√†o. H√£y nh·∫≠p ƒëi·ªÉm m·ª•c ti√™u ph√≠a tr√™n!</div>';
            }

            // C·∫£nh b√°o m√¥n h·ªçc y·∫øu
            let warnings = [];
            const semester = `semester${currentSemester}`;

            SUBJECTS.forEach(subject => {
                const avg = parseFloat(calculateSubjectAverage(appData[semester][subject]));
                if (avg > 0 && avg < 5.0) {
                    warnings.push({
                        type: 'danger',
                        subject,
                        avg,
                        message: `‚ö†Ô∏è <strong>${subject}</strong> ƒëang ·ªü m·ª©c Y·∫øu (${avg}). C·∫ßn t·∫≠p trung √¥n t·∫≠p!`
                    });
                } else if (avg >= 5.0 && avg < 6.5) {
                    warnings.push({
                        type: 'warning',
                        subject,
                        avg,
                        message: `üìå <strong>${subject}</strong> ƒëang ·ªü m·ª©c Trung b√¨nh (${avg}). C·∫ßn c·∫£i thi·ªán th√™m!`
                    });
                }
            });

            if (warnings.length > 0) {
                warningsContainer.innerHTML = warnings.map(w => 
                    `<div class="alert alert-${w.type}" style="margin-bottom: 10px;">${w.message}</div>`
                ).join('');
            } else {
                warningsContainer.innerHTML = '<div class="alert alert-success">‚úÖ T·∫•t c·∫£ c√°c m√¥n ƒë·ªÅu ƒë·∫°t m·ª©c Kh√° tr·ªü l√™n. Gi·ªØ v·ªØng phong ƒë·ªô nh√©!</div>';
            }
        }

        // Kh·ªüi ƒë·ªông ·ª©ng d·ª•ng
        loadData();
        renderSubjects();
        updateSummary();
    </script>
</body>
</html>
